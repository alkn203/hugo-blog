+++
date = "2015-11-05T20:55:06+09:00"
draft = false
slug = ""
tags = ["tutorial", "breakout"]
title = "【phina.js】ゲーム作成チュートリアル（ブロック崩し）第6回＝Tweenerを使ったアニメーション処理＝"

+++

### はじめに
前回は、ブロックの消去処理を追加しました。
今回は、ゲームとしての見栄えを良くするために、ブロックがアニメーションして消えるようにしたいと思います。

### Tweenerを使ったアニメーション処理

**phina.js**には**Tweener**という機能があり、オブジェクトに対して移動、拡大・縮小、回転などといったアニメーションを簡単に設定することができます。
今回は、ブロックが**縮小して消える**ようにしてみます。

### アニメーション用ダミーブロックの作成

ブロックそのものに**Tweener**を設定しても良いのですが、消去アニメーション中も当たり判定が有効だと予期しない動作を招きかねないので、アニメーション用のダミーブロックを別途作成してから、それに**Tweener**を設定する方法をとります。
コードは以下のとおりです。

<div class='runstant'><iframe src='http://goo.gl/2SQ3Zh' width='100%' height='640px' style='border:0px;box-shadow:0px 0px 2px 0px #aaa'></iframe></div>

### コード説明

##### 20行目

```js
    // ダミーブロックグループ
    this.dummyGroup = CanvasElement().addChildTo(this);
```

* **dummyGroup**は、ダミーブロック用のグループです。

##### 189から204行目

```js
// ブロックの消去処理
disableBlock: function(block) {
  // 消去アニメーション用のダミーブロック
  var dummy = Block().addChildTo(this.dummyGroup);
  // 属性コピー
  dummy.x = block.x;
  dummy.y = block.y;
  // ブロック削除
  block.remove();
  // 縮小して消えるアニメーション
  dummy.tweener.clear()
               .to({scaleX: 0.1, scaleY: 0.1}, 200)
               .call(function() {
                 dummy.remove();
               });
},
```

* **disableBlock**では、まず引数で与えられたブロックの位置情報をコピーしてダミーブロックを作っています。そして、元のブロックを消去しています。

```js
// 縮小して消えるアニメーション
dummy.tweener.clear()
             .to({scaleX: 0.1, scaleY: 0.1}, 200)
             .call(function() {
               dummy.remove();
             });
```
* ダミーブロックの**Tweener**設定を行っています。
* **clear()**で一旦初期化し、**to**でパラメータの変更を行います。
* 今回は縮小を行うので、**scaleX**と**scaleY**に縮小後の大きさを割合で指定します。**0.1**の場合は、元の0.1倍の大きさになります。
* その後の数字で、そのアニメーションをどれ位の時間をかけて行うかを指定します。単位は**ミリ秒**です。
* 次の**call**で、任意の処理を呼び出すことができます。ここでは、ダミーを消去したいので**remove**としています。
* 一連の処理は、チェインメソッドで繋げることができ、順番に実行されます。
* つまり今回は、**200ミリ秒かけて0.1倍まで縮小させた後に、自分自身を消去する**という一連の処理になります。

##### 122行目　他

```js
            // ブロック削除処理
            self.disableBlock(block);
```

* 前回までの**remove**関数を上記のコードに置き換えます。

### 今回はここまで
今回は**phina.js**の目玉機能の１つとも言える**Tweener**を使って、ブロックの消去アニメーションを作ってみました。
次回はいよいよ最終回です。最終回では、もう少しゲームらしくするために、ゲームオーバーとクリア処理を追加してみたいと思います。
